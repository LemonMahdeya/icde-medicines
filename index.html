<!DOCTYPE html>
<html>
<head>
    <title>Medicine Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .autocomplete-item { padding:5px 10px; cursor:pointer; }
        .autocomplete-item:hover { background:#f0f0f0; }
        #autocomplete-list {
            border:1px solid #ccc;
            max-height:200px;
            overflow-y:auto;
            background:white;
            position:absolute;
            z-index:1000;
            width:100%;
            border-radius:4px;
        }
        .autocomplete-container { position:relative; }
    </style>
</head>
<body class="container mt-5">
<h2>Search Medicine</h2>

<div class="row">
  <div class="col-md-6 autocomplete-container">
    <input type="text" id="search" class="form-control" placeholder="Enter Trade or Scientific Name">
    <div id="autocomplete-list"></div>
  </div>
  <div class="col-md-3">
    <button id="search-btn" class="btn btn-primary w-100">Search</button>
  </div>
</div>

<hr>
<div id="results"></div>

<script>
let data = [];

// تحميل بيانات JSON من نفس Repo
fetch('medicines.json')
  .then(res => res.json())
  .then(json => data = json);

let input = document.getElementById('search');
let list = document.getElementById('autocomplete-list');
let resultsDiv = document.getElementById('results');
let searchBtn = document.getElementById('search-btn');

// AutoComplete
input.addEventListener('input', function() {
    let term = this.value.toLowerCase();
    list.innerHTML = '';

    if (!term) return;

    let suggestions = data.filter(d => 
        d.TradeName.toLowerCase().includes(term) || 
        d.ScientificName.toLowerCase().includes(term)
    ).slice(0,10);

    suggestions.forEach(d => {
        let div = document.createElement('div');
        div.classList.add('autocomplete-item');
        div.textContent = `${d.TradeName} (${d.ScientificName})`;
        div.addEventListener('click', function() {
            input.value = d.TradeName;
            list.innerHTML = '';
            showResults([d]);
        });
        list.appendChild(div);
    });
});

// البحث بالزر
searchBtn.addEventListener('click', function(e) {
    e.preventDefault();
    let term = input.value.toLowerCase();
    let filtered = data.filter(d =>
        d.TradeName.toLowerCase().includes(term) || 
        d.ScientificName.toLowerCase().includes(term)
    );
    showResults(filtered);
    list.innerHTML = '';
});

// عرض النتائج
function showResults(filtered) {
    if (!filtered.length) {
        resultsDiv.innerHTML = '<p>No results found.</p>';
        return;
    }
    let html = `<table class="table table-bordered">
        <thead>
          <tr>
            <th>Trade Name</th>
            <th>Scientific Name</th>
            <th>Price</th>
            <th>Drug Type</th>
            <th>ICD 10</th>
            <th>Indication</th>
          </tr>
        </thead>
        <tbody>
          ${filtered.map(d => `<tr>
            <td>${d.TradeName}</td>
            <td>${d.ScientificName}</td>
            <td>${d.Price}</td>
            <td>${d.DrugType}</td>
            <td>${d.ICD10}</td>
            <td>${d.Indication}</td>
          </tr>`).join('')}
        </tbody>
      </table>`;
    resultsDiv.innerHTML = html;
}

// اغلاق الـ autocomplete لو ضغط خارجها
document.addEventListener('click', function(e) {
    if (!e.target.closest('.autocomplete-container')) list.innerHTML = '';
});
</script>
</body>
</html>
